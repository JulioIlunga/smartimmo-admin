{% extends 'agent_work_space/index.html.twig' %}

{% block title %}Smart-Immo | Admin{% endblock %}
{% block style %}
<style>
    /* ====== Beautiful Property Cards ====== */
    :root{
        --brand:#dc3545;
        --ink-weak:#8b949e;
        --ink-soft:#a6adba;
        --surface:#ffffff;
        --media-bg:#0b0d11;
    }

    /* Card shell */
    .property-card{
        position:relative;
        background:var(--surface);
        border:1px solid rgba(16,18,22,.06);
        border-radius:1rem;
        box-shadow:0 10px 24px rgba(16,18,22,.06);
        overflow:hidden;
        transition:transform .15s ease, box-shadow .15s ease;
    }
    .property-card:hover{
        transform:translateY(-1px);
        box-shadow:0 14px 30px rgba(16,18,22,.10);
    }

    /* Compact media area (smaller image) */
    .media-wrap{
        position:relative;
        height:170px;                 /* <<< thumbnail height */
        background:var(--media-bg);
        overflow:hidden;
    }
    @media (min-width: 768px){
        .media-wrap{ height:160px; }  /* slightly smaller on md+ if desired */
    }
    .media-img{
        position:absolute; inset:0;
        width:100%; height:100%;
        object-fit:cover; object-position:center;
        display:block;
        transform:scale(1);
        transition:transform .35s ease, filter .35s ease;
    }
    .media-wrap:hover .media-img{ transform:scale(1.03); filter:saturate(1.02); }

    /* Overlay gradient for legibility */
    .media-overlay{
        position:absolute; inset:0;
        pointer-events:none;
        background:linear-gradient(180deg, rgba(0,0,0,.0) 40%, rgba(0,0,0,.22) 70%, rgba(0,0,0,.45) 100%);
        opacity:.9;
    }

    /* Top badges */
    .ribbon{
        position:absolute; top:.6rem; left:.6rem; z-index:3;
        display:inline-flex; align-items:center; gap:.35rem;
        padding:.28rem .55rem;
        border-radius:.55rem;
        font-size:.75rem; font-weight:800;
        color:#8b1f28; background:rgba(220,53,69,.12);
        border:1px solid rgba(220,53,69,.28);
        box-shadow:0 6px 14px rgba(0,0,0,.12);
    }
    .media-chip{
        position:absolute; top:.6rem; right:.6rem; z-index:3;
        padding:.3rem .55rem; border-radius:.55rem;
        font-size:.78rem; font-weight:800;
        color:#fff; background:rgba(0,0,0,.35);
        backdrop-filter: blur(6px);
        border:1px solid rgba(255,255,255,.18);
    }

    /* Caption over media (optional) */
    .media-caption{
        position:absolute; left:.75rem; right:.75rem; bottom:.6rem; z-index:3;
        color:#fff; display:flex; flex-direction:column; gap:.3rem;
    }
    .media-caption .title{
        font-weight:900; letter-spacing:.02em; font-size:.95rem;
        text-shadow:0 2px 10px rgba(0,0,0,.25);
    }
    .media-caption .chips{ display:flex; flex-wrap:wrap; gap:.35rem; }

    /* Chips */
    .chip{
        display:inline-flex; align-items:center; gap:.35rem;
        padding:.22rem .5rem; border-radius:999px; font-size:.72rem; font-weight:800;
        background:rgba(255,255,255,.12); color:#fff;
        border:1px solid rgba(255,255,255,.2);
    }
    .chip-warning{ background:rgba(255,193,7,.16); border-color:rgba(255,193,7,.35); color:#f7c948; }
    .chip-danger{  background:rgba(220,53,69,.18); border-color:rgba(220,53,69,.35); color:#ff8b96; }
    .chip-muted{   background:rgba(255,255,255,.10); border-color:rgba(255,255,255,.18); color:#e9eef2; }

    /* Body under media */
    .property-body{ padding:.9rem 1rem 1.05rem; }
    .property-meta{
        display:flex; flex-wrap:wrap; gap:.45rem .85rem;
        color:var(--ink-soft); font-size:.86rem;
    }
    .property-price{
        display:flex; align-items:baseline; gap:.4rem;
        margin-top:.35rem;
    }
    .property-price .amount{ font-weight:900; }
    .property-price .unit{ color:#6c757d; font-weight:700; }

    /* Right-side actions (for list layout) */
    .actions-stack .dropdown-toggle{ white-space:nowrap; }

    /* Subtle “subtle badge” fallbacks if theme lacks them */
    .bg-success-subtle{ background:rgba(25,135,84,.12)!important; }
    .border-success-subtle{ border-color:rgba(25,135,84,.35)!important; }
    .bg-secondary-subtle{ background:rgba(108,117,125,.12)!important; }
    .border-secondary-subtle{ border-color:rgba(108,117,125,.35)!important; }

    /* Utility for object-fit variants */
    .obj-contain{ object-fit:contain; }

</style>

{% endblock %}
{% block bodyHeader %}

    <div class="py-1 border-bottom">
        <div class="row mb-2">
            <div class="col-sm-3">
                <h4 class="mb-md-0 fw-bold">Admin</h4>
            </div>
            <div class="col-sm-9">
                <form id="property-admin-search-form" onsubmit="return false;">
                    <div class="d-flex ms-auto justify-content-md-end">
                        <div class="input-group w-50 py-1 me-2 bg-white rounded-9 border">
                            <span class="input-group-text bg-white rounded-9 border-0 mdi mdi-account pr-0 fs-5 text-muted py-0" id="agent"></span>
                            <select name="search" id="search" class="form-control select2 border-0 px-0" onchange="doSearchPropertyAdmin()">
                                <option value="">-- Tous --</option>
                                {% for user in users %}
                                    <option value="{{ user.id }}" {% if search == user.id %} selected {% endif %}>{{ user.firstname }} {{ user.name }} {{ user.phone }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <button onclick="doSearchPropertyAdmin()" class="btn btn-success btn-sm text-white rounded-9 ms-2 me-1"><span class="mdi mdi-book-search fs-5"></span></button>
                        <button onclick="window.location.reload()" class="btn btn-danger btn-sm text-white rounded-9"><span class="mdi mdi-reload fs-5"></span></button>

                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block bodyContent %}

    {% include 'agent_work_space/partials/_flag.html.twig' %}
    <!-- Listings -->
    <div class="row listing-items mt-3" id="listing-admin-table">
        {% include 'smart_immo_admin/published/listing_table.html.twig' %}
    </div>

    <script>
        function doSearchPropertyAdmin() {
            const url = "{{ path('app_smart_immo_admin_search') }}";
            const content = '<div class="text-center"> <div class="spinner-border text-primary m-1" role="status"> <span class="sr-only"></span></div>';

            $.ajax({
                url: url,
                type: "post",
                data: $("#property-admin-search-form").serialize(),
                beforeSend: function () {
                    $("#listing-admin-table").html(content);
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert(xhr.status);
                },
                success: function (data) {
                    $("#listing-admin-table").html(data);
                }
            });
            return false;
        }
    </script>

{% endblock %}